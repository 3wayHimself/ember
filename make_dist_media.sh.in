#! /bin/sh
current=${PWD}
media_dir=ember-media-@VERSION@

mkdir -p ${media_dir}/media/common
cd ${media_dir}
#try to get the textures needed
#don't include lines starting with "/"
grep -rIE --no-filename "^[^/].*texture 3d"  ../media/materials/scripts/*.material | replace "texture 3d_" "3d_" > common_textures.list
cd ${current}/media/common ; tar cf - `cat ${current}/${media_dir}/common_textures.list ` | ( cd ${current}/${media_dir}/media/common; tar xf -)

#copy all meshes
cd ${current}/media ; tar cf - `find -L . -iname \*.mesh` | ( cd ${current}/${media_dir}/media; tar xf -)
cd ${current}/media ; tar cf - `find -L . -iname \*.skeleton` | ( cd ${current}/${media_dir}/media; tar xf -)

#get the theme media dir
mkdir -p ${current}/${media_dir}/media/common/themes/ember
cd ${current}/media/common/themes/ember ; tar cf - `find . -iname \*.png` | ( cd ${current}/${media_dir}/media/common/themes/ember; tar xf -)
cd ${current}/media/common/themes/ember ; tar cf - `find . -iname \*.tga` | ( cd ${current}/${media_dir}/media/common/themes/ember; tar xf -)
cd ${current}/media/common/themes/ember ; tar cf - `find . -iname \*.jpeg` | ( cd ${current}/${media_dir}/media/common/themes/ember; tar xf -)
cd ${current}/media/common/themes/ember ; tar cf - `find . -iname \*.jpg` | ( cd ${current}/${media_dir}/media/common/themes/ember; tar xf -)


mkdir -p ${current}/${media_dir}/media/materials
cd ${current}/media/materials ; tar cf - `find . -iname \*.png` | ( cd ${current}/${media_dir}/media/materials; tar xf -)
cd ${current}/media/materials ; tar cf - `find . -iname \*.jpg` | ( cd ${current}/${media_dir}/media/materials; tar xf -)
cd ${current}/media/materials ; tar cf - `find . -iname \*.cg` | ( cd ${current}/${media_dir}/media/materials; tar xf -)
cd ${current}/media/materials ; tar cf - `find . -iname \*.program` | ( cd ${current}/${media_dir}/media/materials; tar xf -)
cd ${current}/media/materials ; tar cf - `find . -iname \*.asm` | ( cd ${current}/${media_dir}/media/materials; tar xf -)
cd ${current}/media/materials ; tar cf - `find . -iname \*.ps` | ( cd ${current}/${media_dir}/media/materials; tar xf -)
cd ${current}/media/materials ; tar cf - `find . -iname \*.material` | ( cd ${current}/${media_dir}/media/materials; tar xf -)

#cd ${current}/media/models ; tar cf - `find . -iname \*.mesh` | ( cd ${current}/${media_dir}/media/models; tar xf -)
#cd ${current}/media/models ; tar cf - `find . -iname \*.skeleton` | ( cd ${current}/${media_dir}/media/models; tar xf -)
mkdir -p ${current}/${media_dir}/media/particle
cd ${current}/media/particle ; tar cf - `find . -iname \*.particle` | ( cd ${current}/${media_dir}/media/particle; tar xf -)

mkdir -p ${current}/${media_dir}/media/sounds
cd ${current}/media/sounds; tar cf - `find . -iname \*.wav` | ( cd ${current}/${media_dir}/media/sounds; tar xf -)

cd ${current}/${media_dir}
#cp -a ../media/README ../media/fonts ../media/materials ../media/models ../media/packs ../media/particle media
cp -a ../media/README media
rm -f ${current}/${media_dir}/common_textures.list


